<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="mineucore-物理内存管理学习笔记"><meta name="keywords" content><meta name="author" content="Po1lux"><meta name="copyright" content="Po1lux"><title>mineucore-物理内存管理学习笔记 | Po1lux's Diary</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-bootloader探测真实物理内存大小（bootasm-S）"><span class="toc-number">1.</span> <span class="toc-text">0x00 bootloader探测真实物理内存大小（bootasm.S）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-使能段页式内存管理机制的设计方案（entry-S）"><span class="toc-number">2.</span> <span class="toc-text">0x01 使能段页式内存管理机制的设计方案（entry.S）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一阶段（开启保护模式，创建启动段表）"><span class="toc-number">2.1.</span> <span class="toc-text">第一阶段（开启保护模式，创建启动段表）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二阶段（创建初始页目录表，开启分页模式）"><span class="toc-number">2.2.</span> <span class="toc-text">第二阶段（创建初始页目录表，开启分页模式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三阶段（完善段表和页表）"><span class="toc-number">2.3.</span> <span class="toc-text">第三阶段（完善段表和页表）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02初始化物理内存管理（pmm-c-page-init）"><span class="toc-number">3.</span> <span class="toc-text">0x02初始化物理内存管理（pmm.c:page_init）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-初始化空闲物理内存（default-pmm-c-default-init-memmap）"><span class="toc-number">4.</span> <span class="toc-text">0x03 初始化空闲物理内存（default_pmm.c:default_init_memmap）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-first-fit连续物理内存分配算法（实验）"><span class="toc-number">5.</span> <span class="toc-text">0x04 first-fit连续物理内存分配算法（实验）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#思路"><span class="toc-number">5.1.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">5.2.</span> <span class="toc-text">实现</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/Po1lux/Po1lux.github.io/hexo/source/images/IMG.jpg"></div><div class="author-info__name text-center">Po1lux</div><div class="author-info__description text-center">陈戳戳的日记本</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">49</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">28</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://raw.githubusercontent.com/Po1lux/Po1lux.github.io/hexo/source/images/IMG_3035.JPG)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Po1lux's Diary</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">mineucore-物理内存管理学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-03</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="0x00-bootloader&#x63A2;&#x6D4B;&#x771F;&#x5B9E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF08;bootasm-S&#xFF09;"><a href="#0x00-bootloader&#x63A2;&#x6D4B;&#x771F;&#x5B9E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF08;bootasm-S&#xFF09;" class="headerlink" title="0x00 bootloader&#x63A2;&#x6D4B;&#x771F;&#x5B9E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF08;bootasm.S&#xFF09;"></a>0x00 bootloader&#x63A2;&#x6D4B;&#x771F;&#x5B9E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF08;bootasm.S&#xFF09;</h2><p>bootloader&#x901A;&#x8FC7;INT 15h&#x4E2D;&#x65AD;&#xFF0C;&#x4E2D;&#x65AD;&#x53F7;&#x4E3A;e820h&#xFF0C;&#x83B7;&#x53D6;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#x4FE1;&#x606F;&#xFF0C;&#x5C06;&#x6570;&#x636E;&#x6309;struct e820map&#x7684;&#x683C;&#x5F0F;&#x4FDD;&#x5B58;&#x5728;&#x865A;&#x62DF;&#x7A7A;&#x95F4;&#x7684;0xc0000000+0x8000&#x5904;</p>
<h2 id="0x01-&#x4F7F;&#x80FD;&#x6BB5;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#xFF08;entry-S&#xFF09;"><a href="#0x01-&#x4F7F;&#x80FD;&#x6BB5;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#xFF08;entry-S&#xFF09;" class="headerlink" title="0x01 &#x4F7F;&#x80FD;&#x6BB5;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#xFF08;entry.S&#xFF09;"></a>0x01 &#x4F7F;&#x80FD;&#x6BB5;&#x9875;&#x5F0F;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x673A;&#x5236;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#xFF08;entry.S&#xFF09;</h2><p>&#x60F3;&#x8981;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;&#x7684;&#x6BB5;&#x9875;&#x5F0F;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x662F;&#xFF1A;</p>
<p>Virtual Address = Linear Address = Pythal Address + 0xC0000000</p>
<p>&#x5B9E;&#x6A21;&#x5F0F;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x662F;&#x6CA1;&#x6709;&#x9875;&#x673A;&#x5236;&#x7684;&#xFF0C;ld&#x5728;&#x94FE;&#x63A5;&#x9636;&#x6BB5;&#x751F;&#x6210;&#x4E86;ucore&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#xFF0C;&#x662F;0xc0100000&#xFF0C;&#x4F46;&#x662F;ucore&#x9700;&#x8981;&#x8FD0;&#x884C;&#x5728;&#x4F4E;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4ECE;&#x8BA1;&#x7B97;&#x673A;&#x52A0;&#x7535;&#x5230;&#x542F;&#x52A8;&#x6BB5;&#x9875;&#x5F0F;&#x7BA1;&#x7406;&#xFF0C;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x53D1;&#x751F;&#x4E86;&#x591A;&#x6B21;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x9636;&#x6BB5;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF1A;</p>
<h3 id="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF08;&#x5F00;&#x542F;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x521B;&#x5EFA;&#x542F;&#x52A8;&#x6BB5;&#x8868;&#xFF09;"><a href="#&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF08;&#x5F00;&#x542F;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x521B;&#x5EFA;&#x542F;&#x52A8;&#x6BB5;&#x8868;&#xFF09;" class="headerlink" title="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF08;&#x5F00;&#x542F;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x521B;&#x5EFA;&#x542F;&#x52A8;&#x6BB5;&#x8868;&#xFF09;"></a>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF08;&#x5F00;&#x542F;&#x4FDD;&#x62A4;&#x6A21;&#x5F0F;&#xFF0C;&#x521B;&#x5EFA;&#x542F;&#x52A8;&#x6BB5;&#x8868;&#xFF09;</h3><p>&#x8BE5;&#x9636;&#x6BB5;&#x662F;bootloader&#x9636;&#x6BB5;&#xFF0C;&#x6B64;&#x65F6;cpu&#x662F;&#x5B9E;&#x6A21;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x5730;&#x5740;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x5982;&#x4E0B;&#xFF1A;<br>Virtual Address = Linear Address = Pythal Address<br>&#x867D;&#x7136;ld&#x94FE;&#x63A5;&#x6587;&#x4EF6;&#x8BF4;&#x660E;&#x4E86;ucore&#x5185;&#x6838;&#x7684;&#x88C5;&#x8F7D;&#x7A7A;&#x95F4;&#x662F;0xC0100000&#xFF0C;&#x4F46;&#x662F;bootloader&#x4F1A;&#x5C06;ucore&#x88C5;&#x8F7D;&#x5230;0x100000&#x4E2D;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readseg(ph-&gt;p_va &amp; <span class="number">0xFFFFFF</span>, ph-&gt;p_memsz, ph-&gt;p_offset);</span><br></pre></td></tr></table></figure>
<h3 id="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF08;&#x521B;&#x5EFA;&#x521D;&#x59CB;&#x9875;&#x76EE;&#x5F55;&#x8868;&#xFF0C;&#x5F00;&#x542F;&#x5206;&#x9875;&#x6A21;&#x5F0F;&#xFF09;"><a href="#&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF08;&#x521B;&#x5EFA;&#x521D;&#x59CB;&#x9875;&#x76EE;&#x5F55;&#x8868;&#xFF0C;&#x5F00;&#x542F;&#x5206;&#x9875;&#x6A21;&#x5F0F;&#xFF09;" class="headerlink" title="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF08;&#x521B;&#x5EFA;&#x521D;&#x59CB;&#x9875;&#x76EE;&#x5F55;&#x8868;&#xFF0C;&#x5F00;&#x542F;&#x5206;&#x9875;&#x6A21;&#x5F0F;&#xFF09;"></a>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF08;&#x521B;&#x5EFA;&#x521D;&#x59CB;&#x9875;&#x76EE;&#x5F55;&#x8868;&#xFF0C;&#x5F00;&#x542F;&#x5206;&#x9875;&#x6A21;&#x5F0F;&#xFF09;</h3><p>&#x5728;entry.S&#x7684;kern_entry&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x548C;&#x9875;&#x8868;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kern_entry:</span><br><span class="line">    # load pa of boot pgdir</span><br><span class="line">    movl $REALLOC(__boot_pgdir), %eax</span><br><span class="line">    movl %eax, %cr3</span><br><span class="line">......</span><br><span class="line">__boot_pgdir:</span><br><span class="line">.globl __boot_pgdir</span><br><span class="line">    # map va 0 ~ 4M to pa 0 ~ 4M (temporary)</span><br><span class="line">    .long REALLOC(__boot_pt1) + (PTE_P | PTE_U | PTE_W)</span><br><span class="line">    .space (KERNBASE &gt;&gt; PGSHIFT &gt;&gt; 10 &lt;&lt; 2) - (. - __boot_pgdir) # pad to PDE of KERNBASE</span><br><span class="line">    # map va KERNBASE + (0 ~ 4M) to pa 0 ~ 4M</span><br><span class="line">    .long REALLOC(__boot_pt1) + (PTE_P | PTE_U | PTE_W)</span><br><span class="line">    .space PGSIZE - (. - __boot_pgdir) # pad to PGSIZE</span><br><span class="line"></span><br><span class="line">.set i, 0</span><br><span class="line">__boot_pt1:</span><br><span class="line">.rept 1024</span><br><span class="line">    .long i * PGSIZE + (PTE_P | PTE_W)</span><br><span class="line">    .set i, i + 1</span><br><span class="line">.endr</span><br></pre></td></tr></table></figure>
<p>&#x89E3;&#x91CA;&#x4E0B;&#x4E34;&#x65F6;&#x6620;&#x5C04;&#x7684;&#x5EFA;&#x7ACB;&#xFF1A;&#x7B2C;9&#x5230;&#x7B2C;13&#x884C;<br>&#x7B2C;&#x4E00;&#x53E5;&#xFF0C;&#x5C06;&#x9875;&#x8868;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x586B;&#x5165;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x9879;&#xFF0C;&#x5B9E;&#x73B0;map va 0 ~ 4M to pa 0 ~ 4M<br><code>.space    &#x7A7A;&#x5B57;&#x8282;&#x6570;&#xFF0C;&#x540E;&#x9762;&#x8DDF;&#x6570;&#x91CF;    .space 4</code><br>&#x7B2C;&#x4E8C;&#x53E5;&#xFF0C;&#x586B;&#x5145;&#x9875;&#x76EE;&#x5F55;&#x8868;&#xFF0C;&#x586B;&#x5230;0xc0000000&#x90A3;&#x9879;&#xFF0C;KERNBASE  = 0xc0000000&#xFF0C;PGSHIFT = 12&#xFF0C;&#x5411;&#x53F3;&#x79FB;12&#x4F4D;&#xFF0C;&#x63A5;&#x7740;&#x5411;&#x53F3;&#x79FB;10&#x4F4D;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x88AB;4K*1k&#xFF08;4M&#xFF09;&#x9664;&#xFF0C;&#x56E0;&#x4E3A;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x9879;&#x4E00;&#x9879;&#x6620;&#x5C04;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x662F;4M&#xFF0C;&#x7136;&#x540E;&#x5DE6;&#x79FB;&#x4E24;&#x4F4D;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E58;4&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x9879;&#x5360;4&#x5B57;&#x8282;&#xFF0C;&#x7136;&#x540E;&#x51CF;&#x53BB;&#xFF08;&#x5F53;&#x524D;&#x5730;&#x5740;&#x51CF;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x7684;&#x5730;&#x5740;&#xFF09;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x51CF;&#x53BB;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x7B2C;&#x4E00;&#x9879;&#x7684;&#x5730;&#x5740;<br>&#x7B2C;&#x4E09;&#x53E5;&#xFF0C;&#x5B8C;&#x6210;map va KERNBASE + (0 ~ 4M) to pa 0 ~ 4M<br>&#x7B2C;&#x56DB;&#x53E5;&#xFF0C;&#x5C06;&#x9875;&#x76EE;&#x5F55;4K&#x5BF9;&#x9F50;</p>
<p>&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x4E3A;&#xFF1A;<br>Virtual Address = Linear Address = Pythal Address&#xFF08;0~4M&#x7684;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF09;<br>Virtual Address = Linear Address = Pythal Address + 0xC0000000&#xFF08;0xC0000000~0xC0000000+4M&#x7684;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF09;</p>
<blockquote>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#x6620;&#x5C04;&#x5462;&#xFF1F;<br>ucore&#x6B64;&#x65F6;&#x5728;0~4M&#x7684;&#x4F4E;&#x865A;&#x62DF;&#x5730;&#x5740;&#x533A;&#x57DF;&#x8FD0;&#x884C;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x4F7F;&#x80FD;&#x6BB5;&#x9875;&#x673A;&#x5236;&#x540E;ucore&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x6DFB;&#x52A0;&#x4E86;<code>Virtual Address = Linear Address = Pythal Address&#xFF08;0~4M&#x7684;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF09;</code>&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;</p>
</blockquote>
<p>&#x63A5;&#x4E0B;&#x6765;&#x8C03;&#x6574;&#x5185;&#x6838;&#x7684;EIP&#x5230;&#x9AD8;&#x865A;&#x62DF;&#x5730;&#x5740;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    # update eip</span><br><span class="line">    # now, eip = 0x1.....</span><br><span class="line">    leal next, %eax</span><br><span class="line">    # set eip = KERNBASE + 0x1.....</span><br><span class="line">    jmp *%eax</span><br><span class="line">next:</span><br></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6E05;&#x9664;&#xFF08;0~4M&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># unmap va 0 ~ 4M, it&apos;s temporary mapping</span><br><span class="line">xorl %eax, %eax</span><br><span class="line">movl %eax, __boot_pgdir</span><br></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x5C31;&#x53EA;&#x6709;&#xFF1A;<br>Virtual Address = Linear Address = Pythal Address + 0xC0000000&#xFF08;0xC0000000~0xC0000000+4M&#x7684;&#x7EBF;&#x6027;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF09;</p>
<h3 id="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;&#x5B8C;&#x5584;&#x6BB5;&#x8868;&#x548C;&#x9875;&#x8868;&#xFF09;"><a href="#&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;&#x5B8C;&#x5584;&#x6BB5;&#x8868;&#x548C;&#x9875;&#x8868;&#xFF09;" class="headerlink" title="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;&#x5B8C;&#x5584;&#x6BB5;&#x8868;&#x548C;&#x9875;&#x8868;&#xFF09;"></a>&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;&#x5B8C;&#x5584;&#x6BB5;&#x8868;&#x548C;&#x9875;&#x8868;&#xFF09;</h3><p>&#x5C06;&#x9875;&#x76EE;&#x5F55;&#x8868;&#x4ECE;&#xFF08;0~4M&#x6269;&#x5145;&#x5230;0~KMEMSIZE&#xFF09;<br>&#x6700;&#x540E;&#x7684;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x4E3A;&#xFF1A;</p>
<p>Virtual Address = Linear Address = Pythal Address + 0xC0000000</p>
<h2 id="0x02&#x521D;&#x59CB;&#x5316;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF08;pmm-c-page-init&#xFF09;"><a href="#0x02&#x521D;&#x59CB;&#x5316;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF08;pmm-c-page-init&#xFF09;" class="headerlink" title="0x02&#x521D;&#x59CB;&#x5316;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF08;pmm.c:page_init&#xFF09;"></a>0x02&#x521D;&#x59CB;&#x5316;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF08;pmm.c:page_init&#xFF09;</h2><p>&#x4ECE;&#x7269;&#x7406;&#x5185;&#x5B58;&#x83B7;&#x53D6;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#x5E03;&#x5C40;<code>struct e820map *memmap = (struct e820map *)(0x8000 + KERNBASE);</code> &#x901A;&#x8FC7;&#x7269;&#x7406;&#x5E03;&#x5C40;&#x83B7;&#x5F97;&#x6700;&#x5927;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x6700;&#x5927;&#x4E0D;&#x5927;&#x4E8E;0x38000000&#xFF0C;&#x4ECE;&#x800C;&#x8BA1;&#x7B97;&#x5F97;&#x5230;&#x9700;&#x8981;&#x591A;&#x5C11;&#x7269;&#x7406;&#x9875;&#x53BB;&#x7BA1;&#x7406;&#x7269;&#x7406;&#x5185;&#x5B58;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (maxpa &lt; end &amp;&amp; begin &lt; KMEMSIZE) {</span><br><span class="line">            maxpa = end;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (maxpa &gt; KMEMSIZE) {<span class="comment">//#define KMEMSIZE            0x38000000   </span></span><br><span class="line">    maxpa = KMEMSIZE;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x56E0;&#x4E3A;&#x52A0;&#x8F7D;ucore&#x7684;&#x7ED3;&#x675F;&#x5730;&#x5740;&#xFF08;&#x7528;end&#x5168;&#x5C40;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x8BB0;&#x5F55;&#xFF09;&#x4EE5;&#x4E0A;&#x7684;&#x9AD8;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x6CA1;&#x6709;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x8BBE;&#x4E3A;&#x7BA1;&#x7406;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x6784;&#x4F53;Page&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x4E3A; <code>pages = (struct Page *)ROUNDUP((void *)end, PGSIZE);</code></p>
<p>&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x8D77;&#x89C1;&#xFF0C;&#x5DF2;&#x4F7F;&#x7528;&#x7269;&#x7406;&#x7A7A;&#x95F4;&#x8BBE;&#x4E3A;0~pages&#xFF0C;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x7A7A;&#x95F4;&#x8BBE;&#x4E3A;pages~0x38000000&#x3002;</p>
<p>&#x7ED3;&#x5C3E;&#x8C03;&#x7528;init_memmap&#x51FD;&#x6570;&#x521D;&#x59CB;&#x5316;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x3002;&#x6BCF;&#x4E00;&#x9875;&#x7269;&#x7406;&#x5E27;&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;Page&#x7ED3;&#x6784;&#x4F53;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Page</span> {</span></span><br><span class="line">    <span class="keyword">int</span> ref;                        <span class="comment">// page frame&apos;s reference counter to page table</span></span><br><span class="line">    <span class="keyword">uint32_t</span> flags;                 <span class="comment">// array of flags that describe the status of the page frame</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> property;          <span class="comment">// the num of free block, used in first fit pm manager</span></span><br><span class="line">    <span class="keyword">list_entry_t</span> page_link;         <span class="comment">// free list link</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>&#x63A5;&#x7740;&#x5BF9;&#x6240;&#x6709;&#x7269;&#x7406;&#x9875;&#x8FDB;&#x884C;&#x5360;&#x7528;&#x6807;&#x8BB0;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; npage; i ++) {</span><br><span class="line">    SetPageReserved(pages + i);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="0x03-&#x521D;&#x59CB;&#x5316;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF08;default-pmm-c-default-init-memmap&#xFF09;"><a href="#0x03-&#x521D;&#x59CB;&#x5316;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF08;default-pmm-c-default-init-memmap&#xFF09;" class="headerlink" title="0x03 &#x521D;&#x59CB;&#x5316;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF08;default_pmm.c:default_init_memmap&#xFF09;"></a>0x03 &#x521D;&#x59CB;&#x5316;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF08;default_pmm.c:default_init_memmap&#xFF09;</h2><p>&#x6E05;&#x9664;&#x6807;&#x5FD7;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x6784;&#x4F53;Page&#x7684;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x8868;&#x793A;pages~KMEMSIZE&#x4E3A;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#xFF0C;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (; p != base + n; p ++) {</span><br><span class="line">    assert(PageReserved(p));</span><br><span class="line">    p-&gt;flags = p-&gt;property = <span class="number">0</span>;</span><br><span class="line">    set_page_ref(p, <span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8BBE;&#x7F6E;&#x7BA1;&#x7406;&#x8FDE;&#x7EED;&#x5185;&#x5B58;&#x7A7A;&#x95F2;&#x5757;&#x7684;&#x7ED3;&#x6784;&#x4F53;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="keyword">list_entry_t</span> free_list;         <span class="comment">// the list header</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> nr_free;           <span class="comment">// # of free pages in this free list</span></span><br><span class="line">} <span class="keyword">free_area_t</span>;</span><br></pre></td></tr></table></figure>
<p>TIPS&#xFF1A;pages~0x38000000&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x9875;&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;Page&#x7ED3;&#x6784;&#x4F53;&#xFF0C;ucore&#x901A;&#x8FC7;Page&#x7ED3;&#x6784;&#x4F53;&#x53BB;&#x7BA1;&#x7406;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF0C;free_area_t&#x7ED3;&#x6784;&#x4F53;&#x8BB0;&#x5F55;&#x7A7A;&#x95F2;&#x7684;&#x8FDE;&#x7EED;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5757;&#x3002;</p>
<h2 id="0x04-first-fit&#x8FDE;&#x7EED;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7B97;&#x6CD5;&#xFF08;&#x5B9E;&#x9A8C;&#xFF09;"><a href="#0x04-first-fit&#x8FDE;&#x7EED;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7B97;&#x6CD5;&#xFF08;&#x5B9E;&#x9A8C;&#xFF09;" class="headerlink" title="0x04 first-fit&#x8FDE;&#x7EED;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7B97;&#x6CD5;&#xFF08;&#x5B9E;&#x9A8C;&#xFF09;"></a>0x04 first-fit&#x8FDE;&#x7EED;&#x7269;&#x7406;&#x5185;&#x5B58;&#x5206;&#x914D;&#x7B97;&#x6CD5;&#xFF08;&#x5B9E;&#x9A8C;&#xFF09;</h2><h3 id="&#x601D;&#x8DEF;"><a href="#&#x601D;&#x8DEF;" class="headerlink" title="&#x601D;&#x8DEF;"></a>&#x601D;&#x8DEF;</h3><p>first-fit&#x7B97;&#x6CD5;&#x7684;&#x601D;&#x8DEF;&#x5C31;&#x662F;&#x6309;&#x5E8F;&#x904D;&#x5386;&#xFF0C;&#x5F53;&#x5927;&#x5C0F;&#x6EE1;&#x8DB3;&#x5373;&#x5206;&#x914D;&#xFF0C;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF1A;&#x5F53;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x65F6;first-fit&#x7684;&#x601D;&#x8DEF;&#x662F;&#x4ECE;&#x7A7A;&#x95F2;&#x94FE;&#x8868;&#x7684;&#x8868;&#x5934;&#x5F00;&#x59CB;&#x5BFB;&#x627E;&#x5730;&#x5740;&#x6700;&#x5C0F;&#x7684;&#x7269;&#x7406;&#x9875;&#xFF0C;&#x901A;&#x8FC7;nr_free-&gt;next&#x6216;&#x8005;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x51FD;&#x6570;list_next&#x53BB;&#x5BFB;&#x627E;&#xFF0C;&#x627E;&#x5230;&#x7A7A;&#x95F2;&#x7269;&#x7406;&#x9875;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5927;&#x5C0F;&#x662F;&#x4E0D;&#x662F;&#x6EE1;&#x8DB3;&#xFF0C;&#x8FD9;&#x4E3B;&#x8981;&#x901A;&#x8FC7;Page&#x7ED3;&#x6784;&#x4F53;&#x7684;property&#x6210;&#x5458;&#x5224;&#x65AD;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x901A;&#x8FC7;le2page&#x5B8F;&#xFF0C;&#x901A;&#x8FC7;&#x94FE;&#x8868;&#x5143;&#x7D20;&#x6307;&#x9488;nr_free&#x8BA1;&#x7B97;&#x51FA;&#x76F8;&#x5E94;&#x7684;Page&#x6307;&#x9488;p&#xFF0C;&#x5F53;property&gt;=n&#x65F6;&#xFF0C;&#x5927;&#x5C0F;&#x6EE1;&#x8DB3;&#xFF0C;&#x5373;&#x5206;&#x914D;&#x51FA;&#x53BB;&#x3002;</p>
<h3 id="&#x5B9E;&#x73B0;"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *</span></span><br><span class="line"><span class="class"><span class="title">default_alloc_pages</span>(<span class="title">size_t</span> <span class="title">n</span>) {</span></span><br><span class="line">    assert(n &gt; <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (n &gt; nr_free) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">page</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="keyword">list_entry_t</span> *le = &amp;free_list;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> optimize (next-fit)</span></span><br><span class="line">    <span class="keyword">while</span> ((le = list_next(le)) != &amp;free_list) {</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">p</span> = <span class="title">le2page</span>(<span class="title">le</span>, <span class="title">page_link</span>);</span></span><br><span class="line">        <span class="keyword">if</span> (p-&gt;property &gt;= n) {</span><br><span class="line">            page = p;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (page != <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="keyword">if</span> (page-&gt;property &gt; n) {</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">p</span> = <span class="title">page</span> + <span class="title">n</span>;</span></span><br><span class="line">            p-&gt;property = page-&gt;property - n;</span><br><span class="line">            SetPageProperty(p);</span><br><span class="line">            list_add_after(&amp;(page-&gt;page_link), &amp;(p-&gt;page_link));</span><br><span class="line">        }</span><br><span class="line">        list_del(&amp;(page-&gt;page_link));</span><br><span class="line">        nr_free -= n;</span><br><span class="line">        ClearPageProperty(page);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">default_free_pages(struct Page *base, <span class="keyword">size_t</span> n) {</span><br><span class="line">    assert(n &gt; <span class="number">0</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">p</span> = <span class="title">base</span>;</span></span><br><span class="line">    <span class="keyword">for</span> (; p != base + n; p ++) {</span><br><span class="line">        assert(!PageReserved(p) &amp;&amp; !PageProperty(p));</span><br><span class="line">        p-&gt;flags = <span class="number">0</span>;</span><br><span class="line">        set_page_ref(p, <span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    base-&gt;property = n;</span><br><span class="line">    SetPageProperty(base);</span><br><span class="line">    <span class="keyword">list_entry_t</span> *le = list_next(&amp;free_list);</span><br><span class="line">    <span class="keyword">while</span> (le != &amp;free_list) {</span><br><span class="line">        p = le2page(le, page_link);</span><br><span class="line">        le = list_next(le);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> optimize</span></span><br><span class="line">        <span class="keyword">if</span> (base + base-&gt;property == p) {</span><br><span class="line">            base-&gt;property += p-&gt;property;</span><br><span class="line">            ClearPageProperty(p);</span><br><span class="line">            list_del(&amp;(p-&gt;page_link));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p + p-&gt;property == base) {</span><br><span class="line">            p-&gt;property += base-&gt;property;</span><br><span class="line">            ClearPageProperty(base);</span><br><span class="line">            base = p;</span><br><span class="line">            list_del(&amp;(p-&gt;page_link));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    nr_free += n;</span><br><span class="line">    le = list_next(&amp;free_list);</span><br><span class="line">    <span class="keyword">while</span> (le != &amp;free_list) {</span><br><span class="line">        p = le2page(le, page_link);</span><br><span class="line">        <span class="keyword">if</span> (base + base-&gt;property &lt;= p) {</span><br><span class="line">            assert(base + base-&gt;property != p);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        le = list_next(le);</span><br><span class="line">    }</span><br><span class="line">    list_add_before(le, &amp;(base-&gt;page_link));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Po1lux</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/10/03/mineucore-物理内存管理学习笔记/">http://yoursite.com/2019/10/03/mineucore-物理内存管理学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">Po1lux's Diary</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/10/06/mineucore-虚拟内存管理学习笔记/"><i class="fa fa-chevron-left">  </i><span>mineucore-虚拟内存管理学习笔记</span></a></div><div class="next-post pull-right"><a href="/2019/09/22/seccomp沙箱机制 &amp; 2019ByteCTF VIP/"><span>seccomp沙箱机制 &amp; 2019ByteCTF VIP</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://raw.githubusercontent.com/Po1lux/Po1lux.github.io/hexo/source/images/IMG_3035.JPG)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Po1lux</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>